{"ast":null,"code":"import _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\nimport React, { Component, Fragment } from \"react\";\nimport { connect } from \"react-redux\";\nimport cn from \"classnames\";\nimport { get } from \"lodash\";\nimport \"./../Authorization.scss\";\nimport Api from \"../../../utils/requestClient/requests\";\nimport UserActions from \"../../../actions/users/users.actions\";\nimport Router from \"next/router\";\nimport { setCookie } from \"../../../utils/cookie\";\n\nvar AuthorizationStep2 =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(AuthorizationStep2, _Component);\n\n  function AuthorizationStep2(props) {\n    var _this;\n\n    _classCallCheck(this, AuthorizationStep2);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(AuthorizationStep2).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      seconds: 59,\n      error: void 0\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmitForm\", function (e) {\n      e.preventDefault();\n\n      if (_this.state.seconds === 0) {\n        return;\n      }\n\n      var _assertThisInitialize = _assertThisInitialized(_this),\n          code1 = _assertThisInitialize.code1,\n          code2 = _assertThisInitialize.code2,\n          code3 = _assertThisInitialize.code3,\n          code4 = _assertThisInitialize.code4;\n\n      var code = \"\".concat(code1.value).concat(code2.value).concat(code3.value).concat(code4.value);\n      var requestData = {\n        phone: _this.props.user.phone,\n        code: code,\n        fcm_token: \"someKey\"\n      };\n\n      _this.stopTimer();\n\n      _this.props.onSetUserData({\n        showModal: true\n      });\n\n      Api.auth(requestData).then(function (data) {\n        data.data.showModal = false;\n        setCookie(\"global_token\", data.data.auth.global_token);\n\n        _this.props.onSetUserData(data.data);\n\n        if (_this.props.user.showStepsAfterLogin) {\n          Router.push(\"/personal-info\");\n        } else {\n          Router.push(\"/\");\n        }\n      })[\"catch\"](function (err) {\n        _this.code1 = React.createRef();\n        _this.code2 = React.createRef();\n        _this.code3 = React.createRef();\n        _this.code4 = React.createRef();\n\n        if (get(err, \"response.data.errorCode\") === \"BLOCKED_USER\") {\n          _this.props.hendleBlockUser();\n        }\n\n        _this.props.onSetUserData({\n          showModal: false\n        });\n\n        _this.setState({\n          error: err.toString()\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onChange\", function (e) {\n      if (e.target.value) {\n        _this.onSubmitForm(e);\n\n        _this.code4.focus();\n      }\n    });\n\n    _this.code1 = React.createRef();\n    _this.code2 = React.createRef();\n    _this.code3 = React.createRef();\n    _this.code4 = React.createRef();\n    _this.startTimer = _this.startTimer.bind(_assertThisInitialized(_this));\n    _this.stopTimer = _this.stopTimer.bind(_assertThisInitialized(_this));\n    _this.countDown = _this.countDown.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(AuthorizationStep2, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.startTimer();\n    } // startTimer\n\n  }, {\n    key: \"startTimer\",\n    value: function startTimer() {\n      this.timer = setInterval(this.countDown, 1000);\n    } // stopTimer\n\n  }, {\n    key: \"stopTimer\",\n    value: function stopTimer() {\n      if (this.timer) clearInterval(this.timer);\n    } // countDown\n\n  }, {\n    key: \"countDown\",\n    value: function countDown() {\n      var onSetUserData = this.props.onSetUserData; // if (this.state.seconds === 0) {\n      //     onSetUserData({successMessage: null})\n      // }\n      // Remove one second, set state so a re-render happens.\n\n      var seconds = this.state.seconds - 1;\n\n      if (seconds !== 0) {\n        this.setState({\n          seconds: seconds\n        });\n      } else {\n        this.stopTimer();\n        this.setState(function (prevState) {\n          return {\n            seconds: 0\n          };\n        });\n        onSetUserData({\n          successMessage: null\n        });\n      }\n    } // componentWillUnmount\n\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.stopTimer();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return __jsx(Fragment, null, __jsx(\"div\", {\n        className: \"authorization-block\"\n      }, __jsx(\"div\", {\n        className: \"authorization-block-form\"\n      }, __jsx(\"div\", {\n        className: \"authorization-block-title\"\n      }, __jsx(\"div\", {\n        className: \"authorization-title\"\n      }, \"\\u05D4\\u05D6\\u05DF \\u05D0\\u05EA \\u05D4\\u05E7\\u05D5\\u05D3 \\u05E9\\u05E7\\u05D9\\u05D1\\u05DC\\u05EA\"), __jsx(\"div\", {\n        className: \"authorization-subtitle\"\n      }, \"\\u05D1SMS \\u05DC\\u05DE\\u05E1\\u05E4\\u05E8 \", __jsx(\"span\", {\n        dir: \"ltr\"\n      }, this.props.user.phone))), __jsx(\"form\", {\n        className: \"authorization-form\",\n        id: \"authorization-form\",\n        onSubmit: function onSubmit(e) {\n          return _this2.onSubmitForm(e);\n        },\n        noValidate: true\n      }, __jsx(\"div\", {\n        className: \"authorization-block-input\",\n        dir: \"ltr\"\n      }, __jsx(\"input\", {\n        className: \"authorization-input-number input-number authorization-input\",\n        type: \"number\",\n        autoFocus: true,\n        ref: function ref(node) {\n          return _this2.code1 = node;\n        },\n        onChange: function onChange() {\n          _this2.code2.focus();\n        }\n      }), __jsx(\"input\", {\n        className: \"authorization-input-number input-number authorization-input\",\n        type: \"number\",\n        ref: function ref(node) {\n          return _this2.code2 = node;\n        },\n        onChange: function onChange() {\n          _this2.code3.focus();\n        }\n      }), __jsx(\"input\", {\n        className: \"authorization-input-number input-number authorization-input\",\n        type: \"number\",\n        ref: function ref(node) {\n          return _this2.code3 = node;\n        },\n        onChange: function onChange() {\n          _this2.code4.focus();\n        }\n      }), __jsx(\"input\", {\n        className: \"authorization-input-number input-number authorization-input\",\n        type: \"number\",\n        ref: function ref(node) {\n          return _this2.code4 = node;\n        },\n        onChange: function onChange(e) {\n          return _this2.onChange(e);\n        }\n      }), this.state.error ? __jsx(\"span\", {\n        className: \"authorization-input-error\"\n      }, \"\\u05E7\\u05D5\\u05D3 \\u05E9\\u05D2\\u05D5\\u05D9\") : null), __jsx(\"div\", {\n        className: \"authorization-block-description\"\n      }, \"\\u05DC\\u05D0 \\u05D4\\u05D2\\u05D9\\u05E2? \\u05EA\\u05D5\\u05DB\\u05DC \\u05DC\\u05E9\\u05DC\\u05D5\\u05D7 \\u05E9\\u05D5\\u05D1 \\u05D1\\u05D7\\u05DC\\u05D5\\u05E3 \\u05D3\\u05E7\\u05D4\"), __jsx(\"div\", {\n        className: \"authorization-block-submit\"\n      }, __jsx(\"input\", {\n        className: cn({\n          \"authorization-timer-submit\": true,\n          \"input-submit\": true,\n          \"btn-grey\": this.state.seconds === 0,\n          \"btn-blue\": this.state.seconds !== 0,\n          \"btn-normal\": true,\n          \"btn-bold\": true\n        }),\n        id: \"authorization-timer-submit\",\n        type: \"submit\",\n        value: this.checkCode ? \"שליחה\" : \"00:\".concat(this.state.seconds > 9 ? this.state.seconds : \"0\".concat(this.state.seconds))\n      }))))));\n    }\n  }, {\n    key: \"checkCode\",\n    get: function get() {\n      var code1 = this.code1,\n          code2 = this.code2,\n          code3 = this.code3,\n          code4 = this.code4;\n      return code1.value && code2.value && code3.value && code4.value;\n    } // onSubmitForm is action to submit form\n\n  }]);\n\n  return AuthorizationStep2;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    user: state.user\n  };\n};\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    onSetUserData: function onSetUserData(action) {\n      dispatch(UserActions.setUserData(action));\n    }\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AuthorizationStep2);","map":null,"metadata":{},"sourceType":"module"}